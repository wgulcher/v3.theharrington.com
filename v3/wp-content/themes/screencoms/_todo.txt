http://en.bainternet.info/2013/add-taxonomy-filter-to-custom-post-type

-----------------

Bainternet WordPress Consultant
About Me
Blog
Contact me
disclaimer
Donations
home posts
WordPress Services

Posted on Feb 10, 2013
Ohad Raz
10 Comments
custom post type,custom taxonomy
Fancy Functions,How To
   



1
inShare
Add Taxonomy filter to Custom Post Type 

Almost every time I use Custom post types i find myself using a custom taxonomy or two and  lately i found the need of filtering the custom post type posts on the admin edit list by these custom taxonomy and since I don’t like to write the same code over and over here is a simple class that gets the job done.
Screenshot

Custom taxonomy filter

The code

?
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
<?php
if (!class_exists('Tax_CTP_Filter')){
  /**
    * Tax CTP Filter Class 
    * Simple class to add custom taxonomy dropdown to a custom post type admin edit list
    * @author Ohad Raz <admin@bainternet.info>
    * @version 0.1
    */
    class Tax_CTP_Filter
    {
        /**
         * __construct 
         * @author Ohad Raz <admin@bainternet.info>
         * @since 0.1
         * @param array $cpt [description]
         */
        function __construct($cpt = array()){
            $this->cpt = $cpt;
            // Adding a Taxonomy Filter to Admin List for a Custom Post Type
            add_action( 'restrict_manage_posts', array($this,'my_restrict_manage_posts' ));
        }
  
        /**
         * my_restrict_manage_posts  add the slelect dropdown per taxonomy
         * @author Ohad Raz <admin@bainternet.info>
         * @since 0.1
         * @return void
         */
        public function my_restrict_manage_posts() {
            // only display these taxonomy filters on desired custom post_type listings
            global $typenow;
            $types = array_keys($this->cpt);
            if (in_array($typenow, $types)) {
                // create an array of taxonomy slugs you want to filter by - if you want to retrieve all taxonomies, could use get_taxonomies() to build the list
                $filters = $this->cpt[$typenow];
                foreach ($filters as $tax_slug) {
                    // retrieve the taxonomy object
                    $tax_obj = get_taxonomy($tax_slug);
                    $tax_name = $tax_obj->labels->name;
  
                    // output html for taxonomy dropdown filter
                    echo "<select name='".strtolower($tax_slug)."' id='".strtolower($tax_slug)."' class='postform'>";
                    echo "<option value=''>Show All $tax_name</option>";
                    $this->generate_taxonomy_options($tax_slug,0,0,(isset($_GET[strtolower($tax_slug)])? $_GET[strtolower($tax_slug)] : null));
                    echo "</select>";
                }
            }
        }
         
        /**
         * generate_taxonomy_options generate dropdown
         * @author Ohad Raz <admin@bainternet.info>
         * @since 0.1
         * @param  string  $tax_slug 
         * @param  string  $parent   
         * @param  integer $level    
         * @param  string  $selected 
         * @return void            
         */
        public function generate_taxonomy_options($tax_slug, $parent = '', $level = 0,$selected = null) {
            $args = array('show_empty' => 1);
            if(!is_null($parent)) {
                $args = array('parent' => $parent);
            }
            $terms = get_terms($tax_slug,$args);
            $tab='';
            for($i=0;$i<$level;$i++){
                $tab.='--';
            }
  
            foreach ($terms as $term) {
                // output each select option line, check against the last $_GET to show the current option selected
                echo '<option value='. $term->slug, $selected == $term->slug ? ' selected="selected"' : '','>' .$tab. $term->name .' (' . $term->count .')</option>';
                $this->generate_taxonomy_options($tax_slug, $term->term_id, $level+1,$selected);
            }
  
        }
    }//end class
}//end if
Usage

Once you have the class in place it’s easy to use as a single line of code:

?
1
new Tax_CTP_Filter(array('CUSTOM_POST_TYPE_NAME' => array('CUSTOM_TAXONOMY_NAME1','CUSTOM_TAXONOMY_NAME2')));
Now lets break it down: CUSTOM_POST_TYPE_NAME is the name of my custom post type, CUSTOM_TAXONOMY_NAME1 and CUSTOM_TAXONOMY_NAME2 are the name of my custom taxonomies.

So lets say for example i have a custom post type “Book” with a “genre” and “author” taxonomies all i have to do is:

?
1
new Tax_CTP_Filter(array('book' => array('genre','author')));
Also if you you can use one instance of the class to add taxonomy filters to multiple post type:

?
1
2
3
4
5
new Tax_CTP_Filter(array(
    'book' => array('genre','author'),
    'movie' => array('genre','actors'),
    'task' => array('task_status'),
));
If you get the idea, enjoy.
Incoming search terms:

custom post type filter
filter custom taxonomy by term wordpress
taxonomy filter wordpress
wordpress custom post type taxonomy filter
Related posts:

Custom Post type getting 404 on Permalinks
Custom Taxonomy Template
Conditional tag taxonomy term and its children






10 Comments for Add Taxonomy filter to Custom Post Type

Sebastian Scaramuzza   Feb 10, 2013
Thanks, it could be very useful! :-)

Reply

luzon   Jun 11, 2013
Hi Ohad,
can you show where to put the code?
is in function or as plugin,
i did try both but seems that its not showing on the admin
thanks in advance

Reply

Ohad Raz   Jun 11, 2013
Humm, It works in both, either theme’s functions.php or a plugin just make sure you include the class before you call it.
The easiest way would be to include the code from above in a file named for example
Tax_CTP_Filter.php
then in your functions.php add this:

include_once("Tax_CTP_Filter.php");
new Tax_CTP_Filter(
   array(
      'CUSTOM_POST_TYPE_NAME' => array('CUSTOM_TAXONOMY_NAME')
   ) 
);
Reply

luzon   Jun 12, 2013
THANKS! Ohad you are the best and your blog is one of the best if not the best!
Its totally works like magic!

p.s
do you have some posts about calenders or booking integration (not for events)?

Reply

Ohad Raz   Jun 16, 2013
Thanks for the kind Words.

Reply

Khandad Niazi   Jul 13, 2013
HI, Great Great Great. It is very useful, For those how know the wordpresss.

Reply

Ohad Raz   Jul 27, 2013
thanks

Reply

kb1j   Aug 13, 2013
Thank you, I really like your classes – I am starting to write some of my own!

Reply

Ohad Raz   Aug 17, 2013
Thanks for the kind words and remember to let us know what you came up with :)

Reply

Manish Mukherjee   Oct 27, 2013
This is great! Thanks. mkm

Reply




Leave a Reply



Ohad Raz

I'm a WordPress Consultant, a WordPress Developer and a WordPress Freelancer
Currently in my third year of Software Engineering B.Sce Degree. 
I've been developing Websites and web applications on WordPress for over 5 years.
I live in Kiryat Gat , Israel.

Write an E-Mail

My profile on WordPress Answers

profile for Bainternet at WordPress, Q&A for WordPress developers and administrators


My Code Poet listing

My Careers 2.0 Profile

My Gravatar.com Profile

My About.Me Profile

Contact Form


Enter your email address to subscribe to this blog and receive notifications of new posts by email.







 




WordPress Developer Ohad Raz on ShortCodes UI
WordPress Developer Alex on How I add a WordPress MetaBox
WordPress Developer Alex on How I add a WordPress MetaBox
WordPress Developer Ohad Raz on ShortCodes UI
WordPress Developer Ohad Raz on Social Comments plugin
Enter your email address to subscribe to this blog and receive notifications of new posts by email.





WordPress Taxonomies Extra Fields the easy way
how to - WordPress Category Extra Fields
Social Comments plugin
Custom taxonomies extra fields

About MeBlogContact medisclaimerDonationshome postsWordPress Services
© 2011 by Bainternet WordPress Consultant

